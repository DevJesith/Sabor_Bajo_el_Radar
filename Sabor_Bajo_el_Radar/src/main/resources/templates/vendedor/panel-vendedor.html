<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    
    <title>Dashboard Vendedor - SBR</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>
    <link th:href="@{/css/vendedor/panel-vendedor.css}" rel="stylesheet"/>
    <link th:href="@{/css/vendedor/side-bar.css}" rel="stylesheet"/>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<!-- Loader Overlay -->
<div id="loader" class="loader-overlay" style="display: none;">
    <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Cargando...</span>
    </div>
</div>

<div class="container-fluid">
    <div class="row">
        <!-- Sidebar -->
        <div id="sidebar" class="col-md-3 col-lg-2 sidebar">
            <div class="text-center py-4 border-bottom">
                <a class="d-inline-block mb-3" href="#">
                    <img class="logo-sidebar" src="https://via.placeholder.com/50/ff6b35/FFFFFF?text=SBR" alt="Logo">
                </a>
                <div class="vendor-avatar mx-auto mb-2"><i class="fas fa-user-circle"></i></div>
                <h6 id="vendorNameSidebar" class="text-white mb-0">Vendedor</h6>
                <small class="text-muted">Panel de Control</small>
            </div>
            
            <div class="sidebar-menu">
                <a class="sidebar-link active" href="#" data-section="dashboard"><i class="fas fa-chart-line"></i> <span
                    class="sidebar-text">Dashboard</span></a>
                <a class="sidebar-link" href="#" data-section="pedidos"><i class="fas fa-receipt"></i> <span
                    class="sidebar-text">Pedidos</span></a>
                <a class="sidebar-link" href="#" data-section="mis-puestos"><i class="fas fa-store"></i> <span
                    class="sidebar-text">Mis Puestos</span></a>
                <a class="sidebar-link" href="#" data-section="productos"><i class="fas fa-box"></i> <span
                    class="sidebar-text">Productos</span></a>
                <a class="sidebar-link" href="#" data-section="ofertas"><i class="fas fa-tags"></i> <span
                    class="sidebar-text">Ofertas</span></a>
            </div>
            
            <div class="mt-auto p-3 border-top">
                <form th:action="@{/logout}" method="post">
                    <button class="btn btn-danger w-100" type="submit"><i class="fas fa-sign-out-alt me-2"></i>Cerrar
                        sesión
                    </button>
                </form>
            </div>
        </div>
        
        <!-- Contenido principal -->
        <main id="mainContent" class="col-md-9 col-lg-10 main-content">
            
            <!-- SECCIÓN: DASHBOARD -->
            <div id="dashboard" class="content-section active">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2>Dashboard</h2>
                </div>
                <div class="row">
                    <div class="col-xl-3 col-md-6 mb-4">
                        <div class="stat-card border-left-primary">
                            <div class="stat-card-body">
                                <div class="row no-gutters align-items-center">
                                    <div class="col mr-2">
                                        <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">Ventas
                                            (Hoy)
                                        </div>
                                        <!-- CAMBIO DE MONEDA -->
                                        <div id="totalVentas" class="h5 mb-0 font-weight-bold text-gray-800">$ 0</div>
                                    </div>
                                    <div class="col-auto"><i class="fas fa-dollar-sign fa-2x text-gray-300"></i></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-3 col-md-6 mb-4">
                        <div class="stat-card border-left-success">
                            <div class="stat-card-body">
                                <div class="row no-gutters align-items-center">
                                    <div class="col mr-2">
                                        <div class="text-xs font-weight-bold text-success text-uppercase mb-1">Pedidos
                                            (Hoy)
                                        </div>
                                        <div id="totalPedidos" class="h5 mb-0 font-weight-bold text-gray-800">0</div>
                                    </div>
                                    <div class="col-auto"><i class="fas fa-receipt fa-2x text-gray-300"></i></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-3 col-md-6 mb-4">
                        <div class="stat-card border-left-info">
                            <div class="stat-card-body">
                                <div class="row no-gutters align-items-center">
                                    <div class="col mr-2">
                                        <div class="text-xs font-weight-bold text-info text-uppercase mb-1">Ticket
                                            Promedio
                                        </div>
                                        <!-- CAMBIO DE MONEDA -->
                                        <div id="ticketPromedio" class="h5 mb-0 font-weight-bold text-gray-800">$ 0
                                        </div>
                                    </div>
                                    <div class="col-auto"><i class="fas fa-clipboard-list fa-2x text-gray-300"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-3 col-md-6 mb-4">
                        <div class="stat-card border-left-warning">
                            <div class="stat-card-body">
                                <div class="row no-gutters align-items-center">
                                    <div class="col mr-2">
                                        <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">Pedidos
                                            Pendientes
                                        </div>
                                        <div id="pedidosPendientes" class="h5 mb-0 font-weight-bold text-gray-800">0
                                        </div>
                                    </div>
                                    <div class="col-auto"><i class="fas fa-comments fa-2x text-gray-300"></i></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-7 mb-4">
                        <div class="card shadow">
                            <div class="card-header py-3">
                                <h6 class="m-0 font-weight-bold text-primary">Ventas de la Semana</h6>
                            </div>
                            <div class="card-body">
                                <canvas id="salesChart"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-5 mb-4">
                        <div class="card shadow">
                            <div class="card-header py-3">
                                <h6 class="m-0 font-weight-bold text-primary">Productos Más Vendidos</h6>
                            </div>
                            <div class="card-body">
                                <canvas id="productsChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- SECCIÓN: PEDIDOS -->
            <div id="pedidos" class="content-section">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2>Gestión de Pedidos</h2>
                    <button class="btn btn-info" onclick="generarPedidoDemo()"><i class="fas fa-magic me-2"></i>Generar
                        Pedido Demo
                    </button>
                </div>
                <div id="listaPedidos" class="row"></div>
            </div>
            
            <!-- Sección: Mis Puestos -->
            <div id="mis-puestos" class="content-section">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2>Mis Puestos</h2>
                    <button class="btn btn-primary" onclick="mostrarModalPuesto()">
                        <i class="fas fa-plus me-2"></i>Nuevo Puesto
                    </button>
                </div>
                <div id="listaPuestos" class="row"></div>
            </div>
            
            <!-- Sección: Productos -->
            <div id="productos" class="content-section">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2>Productos</h2>
                    <button class="btn btn-primary" onclick="mostrarModalProducto()">
                        <i class="fas fa-plus me-2"></i>Nuevo Producto
                    </button>
                </div>
                <div id="alertNoPuestosParaProductos" class="alert alert-warning" style="display: none;">
                    Debes crear al menos un puesto para poder agregar productos.
                </div>
                <div id="listaProductos" class="row"></div>
            </div>
            
            <!-- Sección: Ofertas -->
            <div id="ofertas" class="content-section">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2>Ofertas</h2>
                    <button class="btn btn-primary" onclick="mostrarModalOferta()">
                        <i class="fas fa-plus me-2"></i>Nueva Oferta
                    </button>
                </div>
                <div id="alertNoProductosParaOfertas" class="alert alert-warning" style="display: none;">
                    Debes crear al menos un producto para poder agregar ofertas.
                </div>
                <div id="listaOfertas" class="row"></div>
            </div>
        </main>
    </div>
</div>

<!-- Modales (sin cambios estructurales) -->
<div id="modalPuesto" class="modal fade" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <form id="formPuesto" onsubmit="guardarPuesto(event)">
                <div class="modal-header">
                    <h5 id="modalPuestoTitle" class="modal-title">Nuevo Puesto</h5>
                    <button class="btn-close" type="button" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input id="puestoId" type="hidden">
                    <div class="row">
                        <!-- Columna del Formulario -->
                        <div class="col-lg-7">
                            <h6><i class="fas fa-edit me-2"></i>Información del Puesto</h6>
                            <hr class="mt-2 mb-4">
                            
                            <!-- Área para subir imagen -->
                            <div class="mb-4">
                                <label class="form-label">Imagen principal *</label>
                                <div id="imageUploadArea" class="image-upload-area"
                                     onclick="document.getElementById('puestoImagenInput').click()">
                                    <div id="imageUploadContent" class="text-center">
                                        <i class="fas fa-cloud-upload-alt fa-3x text-muted mb-2"></i>
                                        <p class="text-muted mb-0">Haz clic para subir una imagen</p>
                                        <small class="text-muted">Recomendado: 800x600px</small>
                                    </div>
                                </div>
                                <input id="puestoImagenInput" class="d-none" type="file" accept="image/*">
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label" for="puestoNombre">Nombre del puesto *</label>
                                <input id="puestoNombre" class="form-control" type="text" required
                                       oninput="actualizarVistaPrevia()">
                            </div>
                            <div class="mb-3">
                                <label class="form-label" for="puestoDescripcion">Descripción breve *</label>
                                <textarea id="puestoDescripcion" class="form-control" rows="3" required
                                          oninput="actualizarVistaPrevia()"></textarea>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label" for="puestoUbicacion">Ubicación (Localidad/Barrio)
                                        *</label>
                                    <input id="puestoUbicacion" class="form-control" type="text" required
                                           oninput="actualizarVistaPrevia()">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label" for="puestoCategoria">Tipo de negocio (Categoría)
                                        *</label>
                                    <select id="puestoCategoria" class="form-select" required
                                            onchange="actualizarVistaPrevia()">
                                        <option value="Comida Rápida">Comida Rápida</option>
                                        <option value="Comida Criolla">Comida Criolla</option>
                                        <option value="Postres">Postres</option>
                                        <option value="Bebidas">Bebidas</option>
                                        <option value="Desayunos">Desayunos</option>
                                    </select>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label" for="puestoEmail">Email de contacto</label>
                                    <input id="puestoEmail" class="form-control" type="email">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label" for="puestoEstado">Estado del puesto</label>
                                    <select id="puestoEstado" class="form-select">
                                        <option value="activo">Activo (Visible para clientes)</option>
                                        <option value="inactivo">Inactivo (Oculto)</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-check">
                                <input id="puestoLegalizado" class="form-check-input" type="checkbox" required>
                                <label class="form-check-label" for="puestoLegalizado">
                                    Declaro que mi negocio cumple con las normativas locales.
                                </label>
                            </div>
                        </div>
                        
                        <!-- Columna de la Vista Previa -->
                        <div class="col-lg-5">
                            <h6><i class="fas fa-eye me-2"></i>Así lo verán tus clientes</h6>
                            <hr class="mt-2 mb-4">
                            <div class="preview-container">
                                <div class="preview-card">
                                    <div class="preview-image">
                                        <img id="previewImagen"
                                             src="https://via.placeholder.com/400x300/e9ecef/6c757d?text=Sube+una+imagen"
                                             alt="Vista previa del puesto">
                                    </div>
                                    <div class="preview-content">
                                        <h5 id="previewNombre" class="preview-title">Nombre de tu Puesto</h5>
                                        <div class="preview-category">
                                            <span>Categoría:</span>
                                            <span id="previewCategoriaBadge" class="preview-category-badge">Comida Rápida</span>
                                        </div>
                                        <p id="previewUbicacion" class="preview-location mt-2"><i
                                            class="fas fa-map-marker-alt me-1"></i> Tu ubicación</p>
                                        <p id="previewDescripcion" class="preview-description mt-2">Aquí aparecerá la
                                            descripción de tu negocio.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" type="button" data-bs-dismiss="modal">Cancelar</button>
                    <button class="btn btn-primary" type="submit">Guardar Puesto</button>
                </div>
            </form>
        </div>
    </div>
</div>

<div id="modalProducto" class="modal fade" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <form id="formProducto" onsubmit="guardarProducto(event)">
                <div class="modal-header"><h5 id="modalProductoTitle" class="modal-title">Nuevo Producto</h5>
                    <button class="btn-close" type="button" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input id="productoId" type="hidden">
                    <div class="mb-3"><label class="form-label" for="productoPuestoId">Puesto al que pertenece *</label><select
                        id="productoPuestoId" class="form-select" required></select></div>
                    <div class="mb-3"><label class="form-label" for="productoNombre">Nombre del producto *</label><input
                        id="productoNombre" class="form-control" type="text" required></div>
                    <div class="mb-3"><label class="form-label" for="productoDescripcion">Descripción *</label><textarea
                        id="productoDescripcion" class="form-control" rows="3" required></textarea></div>
                    <div class="row">
                        <div class="col-md-4 mb-3"><label class="form-label" for="productoPrecio">Precio *</label><input
                            id="productoPrecio" class="form-control" type="number" step="0.01" min="0" required></div>
                        <div class="col-md-4 mb-3"><label class="form-label" for="productoStock">Stock *</label><input
                            id="productoStock" class="form-control" type="number" min="0" required></div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label" for="productoCategoria">Categoría *</label>
                            <select id="productoCategoria" class="form-select" required>
                                <option value="Platos Fuertes">Platos Fuertes</option>
                                <option value="Entradas">Entradas</option>
                                <option value="Bebidas">Bebidas</option>
                                <option value="Postres">Postres</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" type="button" data-bs-dismiss="modal">Cancelar</button>
                    <button class="btn btn-primary" type="submit">Guardar</button>
                </div>
            </form>
        </div>
    </div>
</div>
<div id="modalOferta" class="modal fade" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <form id="formOferta" onsubmit="guardarOferta(event)">
                <div class="modal-header"><h5 id="modalOfertaTitle" class="modal-title">Nueva Oferta</h5>
                    <button class="btn-close" type="button" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input id="ofertaId" type="hidden">
                    <div class="mb-3"><label class="form-label" for="ofertaProductoId">Producto en oferta
                        *</label><select id="ofertaProductoId" class="form-select" required></select></div>
                    <div class="mb-3"><label class="form-label" for="ofertaTitulo">Título de la oferta *</label><input
                        id="ofertaTitulo" class="form-control" type="text" required></div>
                    <div class="mb-3"><label class="form-label" for="ofertaDescripcion">Descripción</label><textarea
                        id="ofertaDescripcion" class="form-control" rows="2"></textarea></div>
                    <div class="row">
                        <div class="col-md-4 mb-3"><label class="form-label" for="ofertaDescuento">Descuento (%)
                            *</label><input id="ofertaDescuento" class="form-control" type="number" min="1" max="100"
                                            required></div>
                        <div class="col-md-4 mb-3"><label class="form-label" for="ofertaFechaInicio">Fecha de inicio
                            *</label><input id="ofertaFechaInicio" class="form-control" type="date" required></div>
                        <div class="col-md-4 mb-3"><label class="form-label" for="ofertaFechaFin">Fecha de fin *</label><input
                            id="ofertaFechaFin" class="form-control" type="date" required></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" type="button" data-bs-dismiss="modal">Cancelar</button>
                    <button class="btn btn-primary" type="submit">Guardar</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script th:src="@{/js/vendedor/side-bar.js}"></script>
<script th:src="@{/js/vendedor/panel-vendedor.js}"></script>
</body>
</html>